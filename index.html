<!DOCTYPE html>
<meta charset="UTF-8">
<html ng-app>
<head>
	<script src="lib/jquery-1.10.2.js"></script>
	<script src="lib/angular-1.0.7.js"></script>
	<!--script src="http://d3lp1msu2r81bx.cloudfront.net/kjs/js/lib/kinetic-v4.5.4.min.js"></script-->
	<script src="lib/kinetic.js"></script>
	<link rel="stylesheet" type="text/css" href="lib/style.css" media="screen">
</head>
<script>
	function Ctrl($scope){

		
 	   $scope.addImage = function(url){
			$scope.storePositions();
			$scope.pics.push({url:url});
			
			var loadedImages = 0;
			var images = {};
			var numImages = $scope.pics.length;
			
			
			for(index in $scope.pics){
				images[index] = new Image();
				images[index].onload = function() {
					if(++loadedImages >= numImages){
						drawImages(images);
					}
				}
				images[index].src = $scope.pics[index].url;
			}
		}
		function drawImages(images) { 
			console.log(images);
			var stage = new Kinetic.Stage({
			  container: "container",
			  width: $(document).width()-5,//1600,
			  height: $(document).height()-200
			});
			var layer = new Kinetic.Layer();
			for (index in images){
				var img = new Kinetic.Image({
					  image: images[index],
					  x: $scope.pics[index].x || stage.getWidth() / 2 - 200 / 2,
					  y: $scope.pics[index].y || stage.getHeight() / 2 - 137 / 2,
					  width: $scope.pics[index].width || 100,
					  height: $scope.pics[index].height || 100,
					  draggable: true,
					  id: index
					});
				$scope.images[index] = img;
				img.on('mouseover', function() {
				  document.body.style.cursor = 'pointer';
				});
				img.on('mouseout', function() {
				  document.body.style.cursor = 'default';
				});
				img.on('dragend', function() {
				  document.body.style.cursor = 'default';
				});
				layer.add(img);
			}
			stage.add(layer);
			$scope.stage = stage;
		}
		$scope.storePositions = function(){
			for(index in $scope.pics){
				//console.log(index);
				//console.log('img: ',$scope.images);
				//console.log('img: ',$scope.images[''+index].getAbsolutePosition().x);
				$scope.pics[index].x = $scope.images[''+index].getAbsolutePosition().x;
				$scope.pics[index].y = $scope.images[''+index].getAbsolutePosition().y;
				 //var shape = $scope.stage.get(index);
			}
		}
		$scope.wreakHavoc = function(){
			$scope.pics[0].x = 10;
		}
	}
</script> 

<body ng-controller="Ctrl" ng-init="pics=[];images={};">
<h1 ng-click = "addImage('images/pony.png');" >Click to Load a Pony</h1>
<h1 ng-click = "addImage('images/bull.png');" >Click to Load a Bull</h1>
<h1 ng-click="wreakHavoc();">Wreak Havoc</h1>
	<!--canvas id="container"></canvas-->
	<div id="container"></div>
	
	
<script defer="defer">
	  
</script>

</body>
</html>